#snb

stages:
  - build

build_backend_prod:
  only:
    refs:
      - prod
    changes:
      - backend/**/*
      - .gitlab-ci.yml
  stage: build
  script:
    - docker build -f backend/Dockerfile -t registry.gitlab.com/opensi/snb-backend
    - docker push registry.gitlab.com/opensi/snb-backend
  tags:
    - shell-1
  environment:
    name: production

build_frontend_page_prod:
  only:
    refs:
      - prod
    changes:
      - frontend/**/*
      - .gitlab-ci.yml
  stage: build
  script:
    - cp ./front/.env ./frontend/.env
    - docker -f front/Dockerfile -t registry.gitlab.com/opensi/snb-front
    - docker push registry.gitlab.com/opensi/snb-front
  tags:
    - shell-1
  environment:
    name: production


